<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Notas Uni ‚Äî 100% HTML</title>
  <style>
   body {
  background: #008080; /* verde azulado cl√°sico Win95 */
  font-family: "MS Sans Serif", Tahoma, sans-serif;
  font-size: 14px;
  margin: 0;
  padding: 10px;
  color: black;
}

.app {
  display: grid;
  grid-template-columns: 220px 280px 1fr;
  gap: 8px;
  width: 100%;
  height: 100vh;
}

.panel {
  background: #c0c0c0;
  border: 2px solid #fff;
  border-right-color: #808080;
  border-bottom-color: #808080;
  display: flex;
  flex-direction: column;
}

.header {
  background: navy;
  color: white;
  padding: 3px 6px;
  font-weight: bold;
  font-size: 13px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

h1 {
  margin: 0;
  font-size: 14px;
  font-weight: bold;
}

.btn {
  font-family: "MS Sans Serif", Tahoma;
  font-size: 13px;
  padding: 2px 8px;
  background: #c0c0c0;
  border: 2px solid #fff;
  border-right-color: #808080;
  border-bottom-color: #808080;
  cursor: pointer;
}

.btn:active {
  border: 2px solid #808080;
  border-right-color: #fff;
  border-bottom-color: #fff;
}

.field {
  font-family: "MS Sans Serif", Tahoma;
  border: 2px solid #808080;
  background: white;
  padding: 3px;
  width: 100%;
  box-sizing: border-box;
}

.list {
  flex: 1;
  overflow-y: auto;
  padding: 4px;
}

.item {
  padding: 4px;
  margin: 2px 0;
  border: 1px solid transparent;
  cursor: pointer;
}

.item:hover {
  background: #00008022;
  border: 1px solid #000080;
}

.item.active {
  background: #00008044;
  border: 1px solid navy;
}

.editor {
  flex: 1;
  background: white;
  border: 2px inset #808080;
  padding: 6px;
  overflow-y: auto;
  min-height: 200px;
}

.toolbar {
  background: #c0c0c0;
  border-bottom: 2px solid #808080;
  padding: 2px;
  display: flex;
  gap: 4px;
}

.tool {
  font-size: 12px;
  padding: 2px 6px;
  background: #c0c0c0;
  border: 2px solid #fff;
  border-right-color: #808080;
  border-bottom-color: #808080;
  cursor: pointer;
}

.tool:active {
  border: 2px solid #808080;
  border-right-color: #fff;
  border-bottom-color: #fff;
}

.footer {
  font-size: 12px;
  padding: 3px 6px;
  background: #c0c0c0;
  border-top: 2px solid #fff;
  border-left: 2px solid #fff;
  border-right: 2px solid #808080;
  border-bottom: 2px solid #808080;
  color: black;
}
  </style>
</head>
<body>
  <div class="app">

    <!-- Cursos -->
    <section class="panel" id="coursesPanel">
      <div class="header">
        <h1>üìö Cursos</h1>
        <div class="row">
          <button class="btn" id="addCourseBtn">+ Curso</button>
          <button class="btn ghost" id="importBtn">Importar</button>
          <button class="btn ghost" id="exportBtn">Exportar</button>
        </div>
      </div>
      <div style="padding:8px">
        <input class="field" id="courseSearch" placeholder="Buscar curso..." />
      </div>
      <div class="list" id="courseList"></div>
      <div class="footer">
        <span class="hint">Doble clic para renombrar</span>
        <span id="courseCount" class="hint"></span>
        <button class="btn" onclick="guardarEnBin()">‚òÅ Guardar en nube</button>
        <button class="btn" onclick="cargarDeBin()">‚òÅ Cargar de nube</button>
      </div>
    </section>

    <!-- Notas del curso -->
    <section class="panel" id="notesPanel">
      <div class="header">
        <h1>üìù Notas</h1>
        <div class="row">
          <button class="btn" id="addNoteBtn">+ Nota</button>
          <button class="btn danger" id="deleteNoteBtn">Eliminar</button>
        </div>
      </div>
      <div style="padding:8px">
        <input class="field" id="noteSearch" placeholder="Buscar nota en el curso..." />
      </div>
      <div class="list" id="noteList"></div>
      <div class="footer"><span id="noteCount" class="hint"></span><span class="hint">Selecciona una nota para editar</span></div>
    </section>

    <!-- Editor -->
    <section class="panel" id="editorPanel">
      <div class="header">
        <div>
          <h1 id="currentNoteTitle">Sin t√≠tulo</h1>
          <div class="hint" id="currentCourseName">‚Äî</div>
        </div>
        <div class="row">
          <span class="badge" id="lastSaved">Guardado ‚Ä¢ ‚Äî</span>
          <button class="btn primary" id="downloadHtmlBtn">Descargar HTML</button>
        </div>
      </div>

      <div class="toolbar">
        <button class="tool" data-cmd="bold"><b>B</b></button>
        <button class="tool" data-cmd="italic"><i>I</i></button>
        <button class="tool" data-cmd="underline"><u>U</u></button>
        <button class="tool" data-cmd="insertUnorderedList">‚Ä¢ Lista</button>
        <button class="tool" data-cmd="insertOrderedList">1. Lista</button>
        <button class="tool" id="h2Btn">H2</button>
        <button class="tool" id="linkBtn">üîó Enlace</button>
        <button class="tool" id="clearBtn">Limpiar formato</button>
      </div>

      <div class="meta">
        <span class="pill" id="wordCount">0 palabras</span>
        <span class="pill" id="charCount">0 caracteres</span>
        <span class="pill" id="readingTime">0 min lectura</span>
      </div>

      <div id="editor" class="editor" contenteditable="true"></div>

      <div class="footer">
        <span class="hint">Consejo: selecciona texto y pulsa üîó para crear un enlace.</span>
        <span class="hint" id="status">Listo</span>
      </div>
    </section>
  </div>

  <input type="file" id="importFile" accept="application/json" style="display:none" />

  <script>
  // --- Configuraci√≥n JsonBin.io ---
  const BIN_ID = "68a80facd0ea881f4060088a";
  const API_KEY = "$2a$10$L99vh8nY/ygEPteAt4DlWute2ZvssGNHMs3LMu6kTb5RNltBtae76";
  const BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

  // --- Estado y persistencia ---
  const STORAGE_KEY = 'notasUni.v1';

  const blankState = () => ({
    courses: [],
    selectedCourseId: null,
    selectedNoteId: null
  });

  function saveLocal(){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    document.getElementById('lastSaved').textContent = 'Guardado local ‚Ä¢ ' + new Date().toLocaleString();
  }
  function loadLocal(){
    try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)); }catch(e){ return null }
  }

  let state = loadLocal();
  if(!state){ state = blankState(); saveLocal(); }

  // --- JsonBin.io ---
  async function guardarEnBin(){
    try {
      document.getElementById("status").textContent = "Guardando en nube...";
      await fetch(BIN_URL, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": API_KEY
        },
        body: JSON.stringify({ notas: state })
      });
      document.getElementById("status").textContent = "Guardado en JsonBin ‚úî";
    } catch (e) {
      console.error(e);
      document.getElementById("status").textContent = "Error al guardar ‚ùå";
    }
  }

  async function cargarDeBin(){
    try {
      document.getElementById("status").textContent = "Cargando de nube...";
      const res = await fetch(BIN_URL, { headers: { "X-Master-Key": API_KEY } });
      const data = await res.json();
      if(data.record && data.record.notas){
        state = data.record.notas;
        saveLocal();
        renderAll();
      }
      document.getElementById("status").textContent = "Cargado de JsonBin ‚úî";
    } catch (e) {
      console.error(e);
      document.getElementById("status").textContent = "Error al cargar ‚ùå";
    }
  }

 
  renderAll();
  </script>
</body>
</html>
